<!DOCTYPE html>
<html>
<title>website</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Questrial&family=Roboto:wght@100&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/css/login.css">
<link rel="stylesheet" href="/css/style.css">


<body class="">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6 col-register ">
                <div class="inline justify-content-center-register">
                    <img id="logo" src="/logos/Logo1x.png" alt="">
                    <h1 class="text-center text-dark">Nova Senha</h1>
                </div>
                <div class="form-register">
                    <div class="subtitile">Insira Sua nova senha.</div>
                    <div class="form-body">

                        <div class="form-group">
                            <label for="password" class="form-separator-items">Password</label>
                            <input type="password" class="form-control form-separator-items" name="password"
                                id="password" placeholder="" require>
                        </div>

                        <div class="form-group">
                            <label for="confirm" class="form-separator-items">Confirm password</label>
                            <input type="password" class="form-control form-separator-items" name="confirm" id="confirm"
                                placeholder="" require>
                        </div>

                        <button onclick="submit()"
                            class="btn btn-primary-color btn-cadastrar form-separator-items">SALVAR</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/js/effects.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

        var URL_BASE = "http://localhost:3000";
        var confirm = document.getElementById("confirm");
        var password = document.getElementById("password");
        function validate() {
            if (password.value === "" || confirm.value === "") {
                return Promise.resolve("fieldsNull");
            }

            if (password.value != confirm.value) {
                return Promise.resolve('notEnquals');
            }

            if (password.value != "" && confirm.value != "" && password.value === confirm.value) {
                return Promise.resolve('enquals');
            }
        }

        function submit() {
            validate().then((response) => {
                if (response === 'fieldsNull' || response === 'notEquals') {
                    alert('Campos Vazios ou as senhas não são idênticas !')
                } else {
                    console.log('requeting')
                    //    GET request for remote image in node.js
                    axios({
                        headers: {
                            "Access-Control-Allow-Origin": "*",
                            "Access-Control-Allow-Methods": "GET,PUT,POST,DELETE,PATCH,OPTIONS",
                        },
                        method: 'put',
                        url: `${URL_BASE}/updatePass`,
                        data: {
                            id:document.cookie.split('=')[1],
                            password: password.value,
                        }
                    }).then(function (response) {
                           console.log(response)
                           if(response.data.next){
                               localStorage.setItem("situation", JSON.stringify(response.data))
                               window.location.href = response.data.redirect;
                           }
                    });
                }
            })

        }
    //   logoEffect();
    </script>
</body>

</html>